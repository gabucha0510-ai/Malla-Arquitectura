<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Malla interactiva - Arquitectura (USB)</title>
<style>
  :root{
    --bg:#fbfaf8;
    --muted:#7b7b7b;
    --accent:#8A454E;
    --c1:#E7CA94;
    --c2:#BFD1B7;
    --c3:#C6B2CB;
    --c4:#C8B69E;
    --c5:#C7E9F8;
    --c6:#F0BDCF;
    --c7:#8A454E;
    --card-radius:10px;
    --gap:18px;
    --col-width:230px;
    --font-sans: "Poppins", "Montserrat", system-ui, sans-serif;
  }

  body{
    margin:0;
    font-family:var(--font-sans);
    background:var(--bg);
    color:#222;
    padding:18px;
  }

  header{
    display:flex;
    align-items:center;
    gap:14px;
    margin-bottom:18px;
  }
  header h1{margin:0;font-size:20px;}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center;}
  .controls button{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:white;cursor:pointer}
  .controls .small{padding:6px 8px;font-size:13px}

  .board{display:flex;gap:var(--gap);align-items:flex-start;overflow:auto;padding-bottom:40px;}
  .column{min-width:var(--col-width);max-width:var(--col-width);}
  .col-title{text-align:center;font-weight:600;margin-bottom:8px;font-size:14px;}

  .card{
    border-radius:var(--card-radius);
    padding:10px;
    margin:10px;
    box-shadow:0 6px 12px rgba(20,20,20,0.08);
    cursor:pointer;
    position:relative;
    user-select:none;
    border:1px solid rgba(0,0,0,0.08);
    transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
    color:#222;
  }
  .card:hover{transform:translateY(-4px);box-shadow:0 10px 18px rgba(20,20,20,0.12)}
  .card .code{font-weight:700;font-size:12px;color:rgba(0,0,0,0.6)}
  .card .name{font-size:13px;margin-top:6px}
  .card .reqs{font-size:12px;color:rgba(0,0,0,0.75);margin-top:6px}

  .card.approved{
    outline:3px solid rgba(0,0,0,0.12);
    transform:scale(1.01);
    box-shadow:inset 0 0 8px rgba(0,0,0,0.08);
  }
  .card.approved::after{
    content:"✓";
    position:absolute;
    right:8px;top:8px;
    font-size:13px;
    background:rgba(255,255,255,0.9);
    padding:3px 6px;
    border-radius:6px;
    color:var(--c7);
    font-weight:700;
    border:1px solid rgba(0,0,0,0.1);
  }
  .card.locked{opacity:0.55;cursor:default;}
  .card.locked::before{content:"";position:absolute;inset:0;border-radius:var(--card-radius);pointer-events:none;}

  /* Colores unicolor */
  .card[data-color="c1"]{background:var(--c1);}
  .card[data-color="c2"]{background:var(--c2);}
  .card[data-color="c3"]{background:var(--c3);}
  .card[data-color="c4"]{background:var(--c4);}
  .card[data-color="c5"]{background:var(--c5);}
  .card[data-color="c6"]{background:var(--c6);}
  .card[data-color="c7"]{background:var(--c7);color:white;}
  .card[data-color="c7"] .code{color:rgba(255,255,255,0.9)}

  .legend{margin-top:12px;font-size:13px;color:#444}
  .legend .dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:8px;vertical-align:middle}
  .muted-note{color:#666;font-size:13px;margin-left:8px}

  #connectors{position:absolute;inset:0;pointer-events:none;z-index:0;}

  @media (max-width:900px){
    :root{--col-width:200px}
    header h1{font-size:16px}
  }
</style>
</head>
<body>
<header>
  <h1>Malla interactiva - Arquitectura (USB)</h1>
  <div class="controls">
    <label style="font-size:13px;color:#444">Simular 40 unidades: <input id="check40" type="checkbox"></label>
    <button class="small" id="btnReset">Reset</button>
    <button class="small" id="btnExport">Exportar</button>
    <button class="small" id="btnImport">Importar</button>
  </div>
</header>

<main style="position:relative">
  <svg id="connectors" width="100%" height="100%"></svg>
  <div class="board" id="board"></div>
  <div class="legend">
    <span class="dot" style="background:var(--c1)"></span>Paleta de la malla
    <span class="muted-note"> · Haz clic en una materia para marcarla como aprobada; las materias bloqueadas muestran qué requisito falta.</span>
  </div>
</main>

<script>
const materias = [
  {codigo:"ARQ101", nombre:"Introducción a la Arquitectura", ciclo:1, color:"c1", req:[]},
  {codigo:"ARQ102", nombre:"Historia de la Arquitectura I", ciclo:1, color:"c2", req:[]},
  {codigo:"MAT101", nombre:"Matemáticas I", ciclo:1, color:"c3", req:[]},
  {codigo:"ARQ201", nombre:"Diseño Arquitectónico I", ciclo:2, color:"c4", req:["ARQ101"]},
  {codigo:"ARQ202", nombre:"Historia de la Arquitectura II", ciclo:2, color:"c5", req:["ARQ102"]},
  {codigo:"MAT201", nombre:"Matemáticas II", ciclo:2, color:"c6", req:["MAT101"]},
  {codigo:"ARQ301", nombre:"Diseño Arquitectónico II", ciclo:3, color:"c7", req:["ARQ201","MAT201"]},
];

const board = document.getElementById("board");
const connectors = document.getElementById("connectors");
let aprobadas = JSON.parse(localStorage.getItem("aprobadas-arq")||"[]");

function render(){
  board.innerHTML="";
  const ciclos = [...new Set(materias.map(m=>m.ciclo))].sort((a,b)=>a-b);
  ciclos.forEach(c=>{
    const col = document.createElement("div");
    col.className="column";
    const title = document.createElement("div");
    title.className="col-title";
    title.textContent="Ciclo "+c;
    col.appendChild(title);
    materias.filter(m=>m.ciclo===c).forEach(m=>{
      const card=document.createElement("div");
      card.className="card";
      card.dataset.color=m.color;
      if(aprobadas.includes(m.codigo)) card.classList.add("approved");
      const locked=!m.req.every(r=>aprobadas.includes(r));
      if(locked && !aprobadas.includes(m.codigo)) card.classList.add("locked");
      card.innerHTML=`<div class="code">${m.codigo}</div><div class="name">${m.nombre}</div>
      ${m.req.length?'<div class="reqs">Req: '+m.req.join(", ")+'</div>':""}`;
      card.onclick=()=>{
        if(card.classList.contains("locked")) return;
        if(aprobadas.includes(m.codigo)){
          aprobadas=aprobadas.filter(x=>x!==m.codigo);
        }else{
          aprobadas.push(m.codigo);
        }
        localStorage.setItem("aprobadas-arq",JSON.stringify(aprobadas));
        render();
      };
      col.appendChild(card);
    });
    board.appendChild(col);
  });
  drawConnectors();
}

function drawConnectors(){
  connectors.innerHTML="";
  materias.forEach(m=>{
    m.req.forEach(r=>{
      const from=document.querySelector(`.card .code:contains(${r})`);
      const to=document.querySelector(`.card .code:contains(${m.codigo})`);
    });
  });
}

document.getElementById("btnReset").onclick=()=>{
  aprobadas=[];
  localStorage.removeItem("aprobadas-arq");
  render();
};

document.getElementById("btnExport").onclick=()=>{
  navigator.clipboard.writeText(JSON.stringify(aprobadas));
  alert("Progreso copiado.");
};
document.getElementById("btnImport").onclick=()=>{
  const datos=prompt("Pega tu progreso exportado:");
  if(!datos) return;
  try{
    aprobadas=JSON.parse(datos);
    render();
  }catch(e){alert("Formato inválido");}
};

render();
</script>
</body>
</html>
